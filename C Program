#include "mbed.h"
#include "ADXL362.h"
#include "math.h"
#include "stdio.h"
/*Object Declaration*/
Serial pc(USBTX,USBRX); /*Serial interface */
ADXL362 adxl362(p11, p12, p13, p10); /*Accelerometer*/


int main()
{
    pc.printf("Started\n");              
    

    /*Configure SPI interface and accelerometer*/
    adxl362.init_spi();
    adxl362.init_adxl362();
    wait(0.1);
    pc.printf("adxl initialised\n");
    /*Set default values for parameters*/
    int N=50;
    float T=0.1;
    /*set up empty arrays for data to be added*/

        /*variables for collecting data*/
        int8_t xData= 0 ;
    int8_t yData = 0;
    int8_t zData = 0;
    uint8_t reg;
    pc.printf("Varibles set up\n");


    int i=0;
    while(i<N) {
        pc.printf("while loop opened\n");
        /*Collect data*/
        reg = adxl362.ACC_ReadReg(FILTER_CTL);
        pc.printf("reg thing done\n");
        //pc.printf("FILTER_CTL = 0x%X\r\n", reg);
        adxl362.ACC_GetXYZ8(&xData, &yData, &zData);
        pc.printf("got data\n");
        int roll[1]={(int) xData};
        //int pitch[1]={(int) yData};
        pc.printf("data converted to int\n");
  

        fwrite(roll,1,sizeof(roll),pc);
       // fprintf("/n");
        pc.printf("fwrite done\n");
           
            wait(T); /*Wait T for sample period*/
    i++;
    pc.printf("time waited, i increased\n");
 pc.printf("%i",i);


    }

   
    pc.printf("Done\n");
}

